{% extends "user.html" %}
{% load thumbnail %}

{% block pagetitle %} Answer Paper  for {{ quiz.description }}{% endblock pagetitle %}

{% block script %}
<script type="text/x-mathjax-config">
    MathJax.Ajax.config.path["mhchem"] = "https://cdn.rawgit.com/mhchem/MathJax-mhchem/fae3ec0a";
    MathJax.Hub.Config({
      TeX: {
        extensions: ["[mhchem]/mhchem.js", "color.js"],
        noErrors: { disabled: true }
      }
    });
  </script>
  {% mathjax_scripts %}


<!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script> -->
{% endblock script %}

{% block main %}

{% if not data.papers %}
    <p><b> You have not attempted the quiz {{ quiz.description }} </b></p>
{% else %}
    {% for paper in data.papers %}
    {% if forloop.counter == 2 and data.questionpaperid %}
    <U><h2> Previous attempts </h2></U>
    {% endif %}
    <h2> Quiz: {{ paper.question_paper.quiz.description }} </h2>

    <p>

    Marks obtained: {{ paper.marks_obtained }} <br/>
    Start time: {{ paper.start_time }} <br/>
    End time : {{ paper.end_time }} <br/>
    Percentage obtained: {{ paper.percent }}% <br/>
    {% if paper.passed == 0 %}
    Status : <b style="color: red;"> Failed </b><br/>
    {% else %}
    Status : <b style="color: green;"> Passed </b><br/>
    {% endif %}
    </p>

    {% if paper.answers.count %}
    <h3> Answerpaper: </h3>
    {% for question, answers in paper.get_question_answers.items %}

    <div class="panel panel-info">
        <div class="panel-heading">
            <strong> Details: {{forloop.counter}}
            <span class="marks pull-right"> Mark(s): {{ question.points }} </span>
            </strong>
        </div>
        <div class="panel-body">
            <img src="{% thumbnail question.picture|default:'default_course.png' 840x640 crop %}">

            {% if question.type == "mcq" or question.type == "mcc" or question.type == "paragraph" or question.type == "match" %}
                <h5> <u>Choices:</u></h5>
                {% for testcase in question.get_test_cases %}
                {% if testcase.correct %}
                   <br/>
                   <strong>{{ forloop.counter }}. {{ testcase.options|safe }}</strong>
                   <span class="label label-success"> Correct</span>
                {% else %}
                <br/><strong>
                {{ forloop.counter|safe }}. {{ testcase.options|safe }}</strong>
                {% endif %}
                {% endfor %}

            {% elif question.type == "integer" or "string" or "float" %}
                <h5> <u>Correct Answer:</u></h5>
                    {% for testcase in question.get_test_cases %}
                    <strong>{{ testcase.correct|safe }}</strong>
                    {% endfor %}

            {% else %}
                <h5> <u>Test cases: </u></h5>
                    {% for testcase in question.get_test_cases %}
                        <br/><strong>{{ forloop.counter }}. {{ testcase }}</strong>
                    {% endfor %}
            {% endif %}

        </div>
    </div>
    {% if question.type != "code" %}
        {% if "Correct answer" in answers.0.error_list %}
            <div class="panel panel-success">
        {% else %}
            <div class="panel panel-danger">
        {% endif %}
            <div class="panel-heading">
                Autocheck: {{ answers.0.error_list.0 }}
            </div>
            <div class="panel-body">
                <h5><u>Student Answer:</u></h5>
                <div class="well well-sm">
                 {{ answers.0.answer|safe }}
                 </div>
            </div>
            </div>
    {% else %}
    <h5>Student Answer: </h5>
    {% for answer in answers %}
    {% if not answer.skipped %}
    {% if "Correct answer" in answer.error %}
            <div class="panel panel-success">
        {% else %}
            <div class="panel panel-danger">
        {% endif %}
    <div class="panel-heading">Autocheck: {{ answer.error }} </div>
    <div class="panel-body">
    <pre><code>{{ answer.answer.answer.strip|safe }}</code></pre>
    </div>
    </div>
    {% endif %}
    {% endfor %}
    {% endif %}

    <hr>
    {% endfor %} {# for question, answers ... #}
    <h3>Teacher comments: </h3>
    {{ paper.comments|default:"None" }}
    <hr><hr>
    {% endif %} {# if paper.answers.count #}

    {% endfor %} {# for paper in data.papers #}

{% endif %} {# if not data.papers #}
{% endblock %}
